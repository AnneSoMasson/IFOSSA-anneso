---
title: "NA"
output: html_document
date: "2024-05-16"
---

# 0. Load packages

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
```

# 1. tax_table

## Numbers of unique taxa

### before taxize::gnr_resolve

```{r}
# Import tidy_data and subset every community
tidy_data <- read.csv("final_files/tidy_data/tidy_data_update21-05-24.csv")[,-1]

tidy_data_macrofauna_surface <- tidy_data[which(tidy_data$community=='macrofauna_surface'),]
tidy_data_macrofauna_aerial <- tidy_data[which(tidy_data$community=='macrofauna_aerial'),]
tidy_data_macrofauna_foliar <- tidy_data[which(tidy_data$community=='macrofauna_foliar'),]
tidy_data_nematodes <- tidy_data[which(tidy_data$community=='nematodes'),]
tidy_data_micro_arthropodes <- tidy_data[which(tidy_data$community=='micro_arthropodes'),]
tidy_data_bacteria <- tidy_data[which(tidy_data$community=='bacteria'),]
tidy_data_fungi <- tidy_data[which(tidy_data$community=='fungi'),]
tidy_data_protists <- tidy_data[which(tidy_data$community=='protists'),]

# Count the total number of distinct raw taxa names
tidy_data_numberoftaxa_macrofauna_surface <- as.data.frame(n_distinct(tidy_data_macrofauna_surface$name)) %>% rename("name" = 1)
tidy_data_numberoftaxa_macrofauna_surface <- tidy_data_numberoftaxa_macrofauna_surface %>% mutate("community" = "macrofauna_surface")

tidy_data_numberoftaxa_macrofauna_aerial <- as.data.frame(n_distinct(tidy_data_macrofauna_aerial$name)) %>% rename("name" = 1)
tidy_data_numberoftaxa_macrofauna_aerial <- tidy_data_numberoftaxa_macrofauna_aerial %>% mutate("community" = "macrofauna_aerial")

tidy_data_numberoftaxa_macrofauna_foliar <- as.data.frame(n_distinct(tidy_data_macrofauna_foliar$name)) %>% rename("name" = 1)
tidy_data_numberoftaxa_macrofauna_foliar <- tidy_data_numberoftaxa_macrofauna_foliar %>% mutate("community" = "macrofauna_foliar")

tidy_data_numberoftaxa_nematodes <- as.data.frame(n_distinct(tidy_data_nematodes$name)) %>% rename("name" = 1)
tidy_data_numberoftaxa_nematodes <- tidy_data_numberoftaxa_nematodes %>% mutate("community" = "nematodes")

tidy_data_numberoftaxa_micro_arthropodes <- as.data.frame(n_distinct(tidy_data_micro_arthropodes$name)) %>% rename("name" = 1)
tidy_data_numberoftaxa_micro_arthropodes <- tidy_data_numberoftaxa_micro_arthropodes %>% mutate("community" = "micro_arthropodes")

#tidy_data_numberoftaxa_bacteria <- as.data.frame(n_distinct(tidy_data_bacteria$name)) %>% rename("name" = 1)
#tidy_data_numberoftaxa_bacteria <- tidy_data_numberoftaxa_bacteria %>% mutate("community" = "bacteria")

#tidy_data_numberoftaxa_fungi <- as.data.frame(n_distinct(tidy_data_fungi$name)) %>% rename("name" = 1)
#tidy_data_numberoftaxa_fungi <- tidy_data_numberoftaxa_fungi %>% mutate("community" = "fungi")

#tidy_data_numberoftaxa_protists <- as.data.frame(n_distinct(tidy_data_protists$name)) %>% rename("name" = 1)
#tidy_data_numberoftaxa_protists <- tidy_data_numberoftaxa_protists %>% mutate("community" = "protists")

# Bind the objects tidy_data_numberoftaxa_X and export the results
tidy_data_numberoftaxa_all <- rbind(tidy_data_numberoftaxa_macrofauna_surface, tidy_data_numberoftaxa_macrofauna_aerial, tidy_data_numberoftaxa_macrofauna_foliar, tidy_data_numberoftaxa_nematodes, tidy_data_numberoftaxa_micro_arthropodes) # tidy_data_numberoftaxa_bacteria, tidy_data_numberoftaxa_fungi, tidy_data_numberoftaxa_protists

tidy_data_numberoftaxa_all <- tidy_data_numberoftaxa_all %>% mutate("step" = "before taxize::gnr_resolve")

results <- tidy_data_numberoftaxa_all
```

### after taxize and manual solving

```{r}
# Import tax_table and subset every community
tax_table <- read.csv("final_files/tax_table/tax_table_update21-05-24.csv")[,-1]

tax_table_macrofauna_surface <- tax_table[which(tax_table$community=='macrofauna_surface'),]
tax_table_macrofauna_aerial <- tax_table[which(tax_table$community=='macrofauna_aerial'),]
tax_table_macrofauna_foliar <- tax_table[which(tax_table$community=='macrofauna_foliar'),]
tax_table_nematodes <- tax_table[which(tax_table$community=='nematodes'),]
tax_table_micro_arthropodes <- tax_table[which(tax_table$community=='micro_arthropodes'),]
tax_table_bacteria <- tax_table[which(tax_table$community=='bacteria'),]
tax_table_fungi <- tax_table[which(tax_table$community=='fungi'),]
tax_table_protists <- tax_table[which(tax_table$community=='protists'),]

# Count the number of distinct taxa at each taxonomic level
tax_table_numberoftaxa_macrofauna_surface <- as.data.frame(t(sapply(tax_table_macrofauna_surface[,-9], function(x) n_distinct(x))))
tax_table_numberoftaxa_macrofauna_surface <- tax_table_numberoftaxa_macrofauna_surface %>% mutate("community" = "macrofauna_surface")

tax_table_numberoftaxa_macrofauna_aerial <- as.data.frame(t(sapply(tax_table_macrofauna_aerial[,-9], function(x) n_distinct(x))))
tax_table_numberoftaxa_macrofauna_aerial <- tax_table_numberoftaxa_macrofauna_aerial %>% mutate("community" = "macrofauna_aerial")

tax_table_numberoftaxa_macrofauna_foliar <- as.data.frame(t(sapply(tax_table_macrofauna_foliar[,-9], function(x) n_distinct(x))))
tax_table_numberoftaxa_macrofauna_foliar <- tax_table_numberoftaxa_macrofauna_foliar %>% mutate("community" = "macrofauna_foliar")

tax_table_numberoftaxa_nematodes <- as.data.frame(t(sapply(tax_table_nematodes[,-9], function(x) n_distinct(x))))
tax_table_numberoftaxa_nematodes <- tax_table_numberoftaxa_nematodes %>% mutate("community" = "nematodes")

tax_table_numberoftaxa_micro_arthropodes <- as.data.frame(t(sapply(tax_table_micro_arthropodes[,-9], function(x) n_distinct(x))))
tax_table_numberoftaxa_micro_arthropodes <- tax_table_numberoftaxa_micro_arthropodes %>% mutate("community" = "micro_arthropodes")

#tax_table_numberoftaxa_bacteria <- as.data.frame(t(sapply(tax_table_bacteria[,-9], function(x) n_distinct(x))))
#tax_table_numberoftaxa_bacteria <- tax_table_numberoftaxa_bacteria %>% mutate("community" = "bacteria")

#tax_table_numberoftaxa_fungi <- as.data.frame(t(sapply(tax_table_fungi[,-9], function(x) n_distinct(x))))
#tax_table_numberoftaxa_fungi <- tax_table_numberoftaxa_fungi %>% mutate("community" = "fungi")

#tax_table_numberoftaxa_protists <- as.data.frame(t(sapply(tax_table_protists[,-9], function(x) n_distinct(x))))
#tax_table_numberoftaxa_protists <- tax_table_numberoftaxa_protists %>% mutate("community" = "protists")

# Bind the objects numberoftaxa_X and export the results
tax_table_numberoftaxa_all <- rbind(tax_table_numberoftaxa_macrofauna_surface, tax_table_numberoftaxa_macrofauna_aerial, tax_table_numberoftaxa_macrofauna_foliar, tax_table_numberoftaxa_nematodes, tax_table_numberoftaxa_micro_arthropodes) # tax_table_numberoftaxa_bacteria, tax_table_numberoftaxa_fungi, tax_table_numberoftaxa_protists

tax_table_numberoftaxa_all <- tax_table_numberoftaxa_all %>% mutate("step" = "after taxize and manual solving")

results <- bind_rows(tidy_data_numberoftaxa_all, tax_table_numberoftaxa_all)
```

## Link tidy_data and tax_table

```{r}
tidy_data <- read.csv("final_files/tidy_data/tidy_data_update21-05-24.csv")[,-1]
linked_tidytax <- tidy_data %>% separate_wider_delim(code_uhbr, "_", names = c("usage", "habitat", "block", "replicate"))

# Add tax_table
linked_tidytax$kingdom <- tax_table$kingdom[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$phylum <- tax_table$phylum[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$class <- tax_table$class[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$order <- tax_table$order[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$family <- tax_table$family[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$genus <- tax_table$genus[match(linked_tidytax$name, tax_table$query)]
linked_tidytax$species <- tax_table$species[match(linked_tidytax$name, tax_table$query)]

# Remove rows with NAs
linked_tidytax <- linked_tidytax[complete.cases(linked_tidytax), ]
```

### after linking tidy_data and tax_table

```{r}
# Subset every community

linked_tidytax_macrofauna_surface <- linked_tidytax[which(linked_tidytax$community=='macrofauna_surface'),]
linked_tidytax_macrofauna_aerial <- linked_tidytax[which(linked_tidytax$community=='macrofauna_aerial'),]
linked_tidytax_macrofauna_foliar <- linked_tidytax[which(linked_tidytax$community=='macrofauna_foliar'),]
linked_tidytax_nematodes <- linked_tidytax[which(linked_tidytax$community=='nematodes'),]
linked_tidytax_micro_arthropodes <- linked_tidytax[which(linked_tidytax$community=='micro_arthropodes'),]
linked_tidytax_bacteria <- linked_tidytax[which(linked_tidytax$community=='bacteria'),]
linked_tidytax_fungi <- linked_tidytax[which(linked_tidytax$community=='fungi'),]
linked_tidytax_protists <- linked_tidytax[which(linked_tidytax$community=='protists'),]

# Count the number of distinct taxa at each taxonomic level
linked_tidytax_numberoftaxa_macrofauna_surface <- as.data.frame(t(sapply(linked_tidytax_macrofauna_surface[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_surface <- linked_tidytax_numberoftaxa_macrofauna_surface %>% mutate("community" = "macrofauna_surface")

linked_tidytax_numberoftaxa_macrofauna_aerial <- as.data.frame(t(sapply(linked_tidytax_macrofauna_aerial[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_aerial <- linked_tidytax_numberoftaxa_macrofauna_aerial %>% mutate("community" = "macrofauna_aerial")

linked_tidytax_numberoftaxa_macrofauna_foliar <- as.data.frame(t(sapply(linked_tidytax_macrofauna_foliar[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_foliar <- linked_tidytax_numberoftaxa_macrofauna_foliar %>% mutate("community" = "macrofauna_foliar")

linked_tidytax_numberoftaxa_nematodes <- as.data.frame(t(sapply(linked_tidytax_nematodes[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_nematodes <- linked_tidytax_numberoftaxa_nematodes %>% mutate("community" = "nematodes")

linked_tidytax_numberoftaxa_micro_arthropodes <- as.data.frame(t(sapply(linked_tidytax_micro_arthropodes[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_micro_arthropodes <- linked_tidytax_numberoftaxa_micro_arthropodes %>% mutate("community" = "micro_arthropodes")

linked_tidytax_numberoftaxa_bacteria <- as.data.frame(t(sapply(linked_tidytax_bacteria[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_bacteria <- linked_tidytax_numberoftaxa_bacteria %>% mutate("community" = "bacteria")

linked_tidytax_numberoftaxa_fungi <- as.data.frame(t(sapply(linked_tidytax_fungi[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_fungi <- linked_tidytax_numberoftaxa_fungi %>% mutate("community" = "fungi")

linked_tidytax_numberoftaxa_protists <- as.data.frame(t(sapply(linked_tidytax_protists[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_protists <- linked_tidytax_numberoftaxa_protists %>% mutate("community" = "protists")

# Bind the objects numberoftaxa_X and export the results
linked_tidytax_numberoftaxa_all <- rbind(linked_tidytax_numberoftaxa_macrofauna_surface, linked_tidytax_numberoftaxa_macrofauna_aerial, linked_tidytax_numberoftaxa_macrofauna_foliar, linked_tidytax_numberoftaxa_nematodes, linked_tidytax_numberoftaxa_micro_arthropodes, linked_tidytax_numberoftaxa_bacteria, linked_tidytax_numberoftaxa_fungi, linked_tidytax_numberoftaxa_protists)

linked_tidytax_numberoftaxa_all <- linked_tidytax_numberoftaxa_all %>% mutate("step" = "after linking tidy_data and tax_table")

results <- bind_rows(tidy_data_numberoftaxa_all, tax_table_numberoftaxa_all, linked_tidytax_numberoftaxa_all)
```

### after filtering based on taxonomy

```{r}
# Apply filters
#linked_tidytax_filter <- linked_tidytax[which(linked_tidytax$date=='04/2023'),] # to keep the only common date # TO DO during analysis if needed
linked_tidytax_filter_macrofauna_surface <- linked_tidytax_macrofauna_surface
linked_tidytax_filter_macrofauna_aerial <- linked_tidytax_macrofauna_aerial
linked_tidytax_filter_macrofauna_foliar <- linked_tidytax_macrofauna_foliar[which(linked_tidytax_macrofauna_foliar$kingdom == 'Metazoa'),] # to remove the suspicious Cercozoa in this dataset
linked_tidytax_filter_nematodes <- linked_tidytax_nematodes
linked_tidytax_filter_micro_arthropodes <- linked_tidytax_micro_arthropodes
linked_tidytax_filter_bacteria <- linked_tidytax_bacteria[which(linked_tidytax_bacteria$kingdom == 'Bacteria'),] # to keep only Bacteria
linked_tidytax_filter_fungi <- linked_tidytax_fungi[which(linked_tidytax_fungi$kingdom=='Fungi'),] # to keep only Fungi
linked_tidytax_filter_protists <- linked_tidytax_protists[which(linked_tidytax_protists$kingdom=='Eukaryota'),] # to remove unassigned at kingdom level
#linked_tidytax_filter_protists <- linked_tidytax_filter_protists[which(linked_tidytax_filter_protists$phylum=='Cercozoa'),] # to keep only Cercozoa

# Count the number of distinct taxa at each taxonomic level
linked_tidytax_numberoftaxa_macrofauna_surface <- as.data.frame(t(sapply(linked_tidytax_filter_macrofauna_surface[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_surface <- linked_tidytax_numberoftaxa_macrofauna_surface %>% mutate("community" = "macrofauna_surface")

linked_tidytax_numberoftaxa_macrofauna_aerial <- as.data.frame(t(sapply(linked_tidytax_filter_macrofauna_aerial[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_aerial <- linked_tidytax_numberoftaxa_macrofauna_aerial %>% mutate("community" = "macrofauna_aerial")

linked_tidytax_numberoftaxa_macrofauna_foliar <- as.data.frame(t(sapply(linked_tidytax_filter_macrofauna_foliar[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_macrofauna_foliar <- linked_tidytax_numberoftaxa_macrofauna_foliar %>% mutate("community" = "macrofauna_foliar")

linked_tidytax_numberoftaxa_nematodes <- as.data.frame(t(sapply(linked_tidytax_filter_nematodes[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_nematodes <- linked_tidytax_numberoftaxa_nematodes %>% mutate("community" = "nematodes")

linked_tidytax_numberoftaxa_micro_arthropodes <- as.data.frame(t(sapply(linked_tidytax_filter_micro_arthropodes[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_micro_arthropodes <- linked_tidytax_numberoftaxa_micro_arthropodes %>% mutate("community" = "micro_arthropodes")

linked_tidytax_numberoftaxa_bacteria <- as.data.frame(t(sapply(linked_tidytax_filter_bacteria[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_bacteria <- linked_tidytax_numberoftaxa_bacteria %>% mutate("community" = "bacteria")

linked_tidytax_numberoftaxa_fungi <- as.data.frame(t(sapply(linked_tidytax_filter_fungi[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_fungi <- linked_tidytax_numberoftaxa_fungi %>% mutate("community" = "fungi")

linked_tidytax_numberoftaxa_protists <- as.data.frame(t(sapply(linked_tidytax_filter_protists[,-c(1:9)], function(x) n_distinct(x))))
linked_tidytax_numberoftaxa_protists <- linked_tidytax_numberoftaxa_protists %>% mutate("community" = "protists")

# Bind the objects numberoftaxa_X and export the results
linked_tidytax_numberoftaxa_all_filter <- rbind(linked_tidytax_numberoftaxa_macrofauna_surface, linked_tidytax_numberoftaxa_macrofauna_aerial, linked_tidytax_numberoftaxa_macrofauna_foliar, linked_tidytax_numberoftaxa_nematodes, linked_tidytax_numberoftaxa_micro_arthropodes, linked_tidytax_numberoftaxa_bacteria, linked_tidytax_numberoftaxa_fungi, linked_tidytax_numberoftaxa_protists)

linked_tidytax_numberoftaxa_all_filter <- linked_tidytax_numberoftaxa_all_filter %>% mutate("step" = "after filtering based on taxonomy")

results <- bind_rows(tidy_data_numberoftaxa_all, tax_table_numberoftaxa_all, linked_tidytax_numberoftaxa_all, linked_tidytax_numberoftaxa_all_filter)
```

## Export results and linked tidytax

```{r}
write.csv(results, "intermediate_files/datachecking/results_tidytax.csv")

tidytax_ALL <- bind_rows(linked_tidytax_filter_macrofauna_surface, linked_tidytax_filter_macrofauna_aerial, linked_tidytax_filter_macrofauna_foliar, linked_tidytax_filter_nematodes, linked_tidytax_filter_micro_arthropodes, linked_tidytax_filter_bacteria, linked_tidytax_filter_fungi, linked_tidytax_filter_protists) # bind all communities in one file
write.csv(tidytax_ALL, "final_files/tidytax_update23-05-24.csv")
```

# 2. fun_table

## Numbers of unique taxa and guilds/diets/groups

### after gratin

#### macrofauna_surface

```{r}
# Import fun_tables
fun_table_macrofauna_surface_guilds_family <- read.csv("final_files/fun_table/family/fun_macrofauna_surface_guilds_family_update29-05-24.csv")[,-1] # or read.csv("x", sep=";") if not working
fun_table_macrofauna_surface_groups_family <- read.csv("final_files/fun_table/family/fun_macrofauna_surface_groups_family_update29-05-24.csv")[,-1]
fun_table_macrofauna_surface_diets_family <- read.csv("final_files/fun_table/family/fun_macrofauna_surface_diets_family_update29-05-24.csv")[,-1]
fun_table_macrofauna_surface_interactions_family <- read.csv("final_files/fun_table/family/fun_macrofauna_surface_interactions_family_update29-05-24.csv")[,-1]

# Filter based on conditions above
fun_table_macrofauna_surface_guilds_family <- fun_table_macrofauna_surface_guilds_family[fun_table_macrofauna_surface_guilds_family$queryName %in% linked_tidytax_filter_macrofauna_surface$family,]
fun_table_macrofauna_surface_groups_family <- fun_table_macrofauna_surface_groups_family[fun_table_macrofauna_surface_groups_family$queryName %in% linked_tidytax_filter_macrofauna_surface$family,]
fun_table_macrofauna_surface_diets_family <- fun_table_macrofauna_surface_diets_family[fun_table_macrofauna_surface_diets_family$queryName %in% linked_tidytax_filter_macrofauna_surface$family,]
fun_table_macrofauna_surface_interactions_family <- fun_table_macrofauna_surface_interactions_family[fun_table_macrofauna_surface_interactions_family$queryName %in% linked_tidytax_filter_macrofauna_surface$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_macrofauna_surface_guilds_family$queryName, linked_tidytax_macrofauna_surface$family))

fun_table_numberoftaxa_macrofauna_surface_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_guilds_family$queryName))
fun_table_numberoftaxa_macrofauna_surface_guilds_family <- fun_table_numberoftaxa_macrofauna_surface_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_surface_guilds_family <- fun_table_numberoftaxa_macrofauna_surface_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_macrofauna_surface_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_guilds_family$guildName))
fun_table_numberofguilds_macrofauna_surface_guilds_family <- fun_table_numberofguilds_macrofauna_surface_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_macrofauna_surface_guilds_family <- fun_table_numberofguilds_macrofauna_surface_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_macrofauna_surface_diets_family$queryName, linked_tidytax_macrofauna_surface$family))

fun_table_numberoftaxa_macrofauna_surface_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_diets_family$queryName))
fun_table_numberoftaxa_macrofauna_surface_diets_family <- fun_table_numberoftaxa_macrofauna_surface_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_surface_diets_family <- fun_table_numberoftaxa_macrofauna_surface_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_macrofauna_surface_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_diets_family$dietName))
fun_table_numberofdiets_macrofauna_surface_diets_family <- fun_table_numberofdiets_macrofauna_surface_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_macrofauna_surface_diets_family <- fun_table_numberofdiets_macrofauna_surface_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_macrofauna_surface_groups_family$queryName, linked_tidytax_macrofauna_surface$family))

fun_table_numberoftaxa_macrofauna_surface_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_groups_family$queryName))
fun_table_numberoftaxa_macrofauna_surface_groups_family <- fun_table_numberoftaxa_macrofauna_surface_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_surface_groups_family <- fun_table_numberoftaxa_macrofauna_surface_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_macrofauna_surface_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_groups_family$trophicGroupName))
fun_table_numberofgroups_macrofauna_surface_groups_family <- fun_table_numberofgroups_macrofauna_surface_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_macrofauna_surface_groups_family <- fun_table_numberofgroups_macrofauna_surface_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_macrofauna_surface_interactions_family$queryName, linked_tidytax_macrofauna_surface$family))

fun_table_numberoftaxa_macrofauna_surface_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_interactions_family$queryName))
fun_table_numberoftaxa_macrofauna_surface_interactions_family <- fun_table_numberoftaxa_macrofauna_surface_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_surface_interactions_family <- fun_table_numberoftaxa_macrofauna_surface_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_macrofauna_surface_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_interactions_family$interactionName))
fun_table_numberofinteractionsname_macrofauna_surface_interactions_family <- fun_table_numberofinteractionsname_macrofauna_surface_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_macrofauna_surface_interactions_family <- fun_table_numberofinteractionsname_macrofauna_surface_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_surface_interactions_family$resourceName))
fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_macrofauna_surface_family <- rbind(fun_table_numberoftaxa_macrofauna_surface_guilds_family, fun_table_numberofguilds_macrofauna_surface_guilds_family, fun_table_numberoftaxa_macrofauna_surface_diets_family, fun_table_numberofdiets_macrofauna_surface_diets_family, fun_table_numberoftaxa_macrofauna_surface_groups_family, fun_table_numberofgroups_macrofauna_surface_groups_family, fun_table_numberoftaxa_macrofauna_surface_interactions_family, fun_table_numberofinteractionsname_macrofauna_surface_interactions_family, fun_table_numberofinteractionsresource_macrofauna_surface_interactions_family)

fun_table_numberofall_macrofauna_surface_family <- fun_table_numberofall_macrofauna_surface_family %>% mutate("community" = "macrofauna_surface")
fun_table_numberofall_macrofauna_surface_family <- fun_table_numberofall_macrofauna_surface_family %>% mutate("level" = "family")
```

#### macrofauna_aerial

```{r}
# Import fun_tables
fun_table_macrofauna_aerial_guilds_family <- read.csv("final_files/fun_table/family/fun_macrofauna_aerial_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_macrofauna_aerial_groups_family <- read.csv("final_files/fun_table/family/fun_macrofauna_aerial_groups_family.csv", sep=";")
fun_table_macrofauna_aerial_diets_family <- read.csv("final_files/fun_table/family/fun_macrofauna_aerial_diets_family.csv", sep=";")
fun_table_macrofauna_aerial_interactions_family <- read.csv("final_files/fun_table/family/fun_macrofauna_aerial_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_macrofauna_aerial_guilds_family <- fun_table_macrofauna_aerial_guilds_family[fun_table_macrofauna_aerial_guilds_family$queryName %in% linked_tidytax_filter_macrofauna_aerial$family,]
fun_table_macrofauna_aerial_groups_family <- fun_table_macrofauna_aerial_groups_family[fun_table_macrofauna_aerial_groups_family$queryName %in% linked_tidytax_filter_macrofauna_aerial$family,]
fun_table_macrofauna_aerial_diets_family <- fun_table_macrofauna_aerial_diets_family[fun_table_macrofauna_aerial_diets_family$queryName %in% linked_tidytax_filter_macrofauna_aerial$family,]
fun_table_macrofauna_aerial_interactions_family <- fun_table_macrofauna_aerial_interactions_family[fun_table_macrofauna_aerial_interactions_family$queryName %in% linked_tidytax_filter_macrofauna_aerial$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_macrofauna_aerial_guilds_family$queryName, linked_tidytax_macrofauna_aerial$family))

fun_table_numberoftaxa_macrofauna_aerial_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_guilds_family$queryName))
fun_table_numberoftaxa_macrofauna_aerial_guilds_family <- fun_table_numberoftaxa_macrofauna_aerial_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_aerial_guilds_family <- fun_table_numberoftaxa_macrofauna_aerial_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_macrofauna_aerial_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_guilds_family$guildName))
fun_table_numberofguilds_macrofauna_aerial_guilds_family <- fun_table_numberofguilds_macrofauna_aerial_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_macrofauna_aerial_guilds_family <- fun_table_numberofguilds_macrofauna_aerial_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_macrofauna_aerial_diets_family$queryName, linked_tidytax_macrofauna_aerial$family))

fun_table_numberoftaxa_macrofauna_aerial_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_diets_family$queryName))
fun_table_numberoftaxa_macrofauna_aerial_diets_family <- fun_table_numberoftaxa_macrofauna_aerial_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_aerial_diets_family <- fun_table_numberoftaxa_macrofauna_aerial_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_macrofauna_aerial_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_diets_family$dietName))
fun_table_numberofdiets_macrofauna_aerial_diets_family <- fun_table_numberofdiets_macrofauna_aerial_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_macrofauna_aerial_diets_family <- fun_table_numberofdiets_macrofauna_aerial_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_macrofauna_aerial_groups_family$queryName, linked_tidytax_macrofauna_aerial$family))

fun_table_numberoftaxa_macrofauna_aerial_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_groups_family$queryName))
fun_table_numberoftaxa_macrofauna_aerial_groups_family <- fun_table_numberoftaxa_macrofauna_aerial_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_aerial_groups_family <- fun_table_numberoftaxa_macrofauna_aerial_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_macrofauna_aerial_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_groups_family$trophicGroupName))
fun_table_numberofgroups_macrofauna_aerial_groups_family <- fun_table_numberofgroups_macrofauna_aerial_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_macrofauna_aerial_groups_family <- fun_table_numberofgroups_macrofauna_aerial_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_macrofauna_aerial_interactions_family$queryName, linked_tidytax_macrofauna_aerial$family))

fun_table_numberoftaxa_macrofauna_aerial_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_interactions_family$queryName))
fun_table_numberoftaxa_macrofauna_aerial_interactions_family <- fun_table_numberoftaxa_macrofauna_aerial_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_aerial_interactions_family <- fun_table_numberoftaxa_macrofauna_aerial_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_interactions_family$interactionName))
fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family <- fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family <- fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_aerial_interactions_family$resourceName))
fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_macrofauna_aerial_family <- rbind(fun_table_numberoftaxa_macrofauna_aerial_guilds_family, fun_table_numberofguilds_macrofauna_aerial_guilds_family, fun_table_numberoftaxa_macrofauna_aerial_diets_family, fun_table_numberofdiets_macrofauna_aerial_diets_family, fun_table_numberoftaxa_macrofauna_aerial_groups_family, fun_table_numberofgroups_macrofauna_aerial_groups_family, fun_table_numberoftaxa_macrofauna_aerial_interactions_family, fun_table_numberofinteractionsname_macrofauna_aerial_interactions_family, fun_table_numberofinteractionsresource_macrofauna_aerial_interactions_family)

fun_table_numberofall_macrofauna_aerial_family <- fun_table_numberofall_macrofauna_aerial_family %>% mutate("community" = "macrofauna_aerial")
fun_table_numberofall_macrofauna_aerial_family <- fun_table_numberofall_macrofauna_aerial_family %>% mutate("level" = "family")
```

#### macrofauna_foliar

```{r}
# Import fun_tables
fun_table_macrofauna_foliar_guilds_family <- read.csv("final_files/fun_table/family/fun_macrofauna_foliar_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_macrofauna_foliar_groups_family <- read.csv("final_files/fun_table/family/fun_macrofauna_foliar_groups_family.csv", sep=";")
fun_table_macrofauna_foliar_diets_family <- read.csv("final_files/fun_table/family/fun_macrofauna_foliar_diets_family.csv", sep=";")
fun_table_macrofauna_foliar_interactions_family <- read.csv("final_files/fun_table/family/fun_macrofauna_foliar_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_macrofauna_foliar_guilds_family <- fun_table_macrofauna_foliar_guilds_family[fun_table_macrofauna_foliar_guilds_family$queryName %in% linked_tidytax_filter_macrofauna_foliar$family,]
fun_table_macrofauna_foliar_groups_family <- fun_table_macrofauna_foliar_groups_family[fun_table_macrofauna_foliar_groups_family$queryName %in% linked_tidytax_filter_macrofauna_foliar$family,]
fun_table_macrofauna_foliar_diets_family <- fun_table_macrofauna_foliar_diets_family[fun_table_macrofauna_foliar_diets_family$queryName %in% linked_tidytax_filter_macrofauna_foliar$family,]
fun_table_macrofauna_foliar_interactions_family <- fun_table_macrofauna_foliar_interactions_family[fun_table_macrofauna_foliar_interactions_family$queryName %in% linked_tidytax_filter_macrofauna_foliar$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_macrofauna_foliar_guilds_family$queryName, linked_tidytax_macrofauna_foliar$family))

fun_table_numberoftaxa_macrofauna_foliar_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_guilds_family$queryName))
fun_table_numberoftaxa_macrofauna_foliar_guilds_family <- fun_table_numberoftaxa_macrofauna_foliar_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_foliar_guilds_family <- fun_table_numberoftaxa_macrofauna_foliar_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_macrofauna_foliar_guilds_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_guilds_family$guildName))
fun_table_numberofguilds_macrofauna_foliar_guilds_family <- fun_table_numberofguilds_macrofauna_foliar_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_macrofauna_foliar_guilds_family <- fun_table_numberofguilds_macrofauna_foliar_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_macrofauna_foliar_diets_family$queryName, linked_tidytax_macrofauna_foliar$family))

fun_table_numberoftaxa_macrofauna_foliar_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_diets_family$queryName))
fun_table_numberoftaxa_macrofauna_foliar_diets_family <- fun_table_numberoftaxa_macrofauna_foliar_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_foliar_diets_family <- fun_table_numberoftaxa_macrofauna_foliar_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_macrofauna_foliar_diets_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_diets_family$dietName))
fun_table_numberofdiets_macrofauna_foliar_diets_family <- fun_table_numberofdiets_macrofauna_foliar_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_macrofauna_foliar_diets_family <- fun_table_numberofdiets_macrofauna_foliar_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_macrofauna_foliar_groups_family$queryName, linked_tidytax_macrofauna_foliar$family))

fun_table_numberoftaxa_macrofauna_foliar_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_groups_family$queryName))
fun_table_numberoftaxa_macrofauna_foliar_groups_family <- fun_table_numberoftaxa_macrofauna_foliar_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_foliar_groups_family <- fun_table_numberoftaxa_macrofauna_foliar_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_macrofauna_foliar_groups_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_groups_family$trophicGroupName))
fun_table_numberofgroups_macrofauna_foliar_groups_family <- fun_table_numberofgroups_macrofauna_foliar_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_macrofauna_foliar_groups_family <- fun_table_numberofgroups_macrofauna_foliar_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_macrofauna_foliar_interactions_family$queryName, linked_tidytax_macrofauna_foliar$family))

fun_table_numberoftaxa_macrofauna_foliar_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_interactions_family$queryName))
fun_table_numberoftaxa_macrofauna_foliar_interactions_family <- fun_table_numberoftaxa_macrofauna_foliar_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_macrofauna_foliar_interactions_family <- fun_table_numberoftaxa_macrofauna_foliar_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_interactions_family$interactionName))
fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family <- fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family <- fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family <- as.data.frame(n_distinct(fun_table_macrofauna_foliar_interactions_family$resourceName))
fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family <- fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_macrofauna_foliar_family <- rbind(fun_table_numberoftaxa_macrofauna_foliar_guilds_family, fun_table_numberofguilds_macrofauna_foliar_guilds_family, fun_table_numberoftaxa_macrofauna_foliar_diets_family, fun_table_numberofdiets_macrofauna_foliar_diets_family, fun_table_numberoftaxa_macrofauna_foliar_groups_family, fun_table_numberofgroups_macrofauna_foliar_groups_family, fun_table_numberoftaxa_macrofauna_foliar_interactions_family, fun_table_numberofinteractionsname_macrofauna_foliar_interactions_family, fun_table_numberofinteractionsresource_macrofauna_foliar_interactions_family)

fun_table_numberofall_macrofauna_foliar_family <- fun_table_numberofall_macrofauna_foliar_family %>% mutate("community" = "macrofauna_foliar")
fun_table_numberofall_macrofauna_foliar_family <- fun_table_numberofall_macrofauna_foliar_family %>% mutate("level" = "family")
```

#### nematodes

```{r}
# Import fun_tables
fun_table_nematodes_guilds_family <- read.csv("final_files/fun_table/family/fun_nematodes_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_nematodes_groups_family <- read.csv("final_files/fun_table/family/fun_nematodes_groups_family.csv", sep=";")
fun_table_nematodes_diets_family <- read.csv("final_files/fun_table/family/fun_nematodes_diets_family.csv", sep=";")
fun_table_nematodes_interactions_family <- read.csv("final_files/fun_table/family/fun_nematodes_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_nematodes_guilds_family <- fun_table_nematodes_guilds_family[fun_table_nematodes_guilds_family$queryName %in% linked_tidytax_filter_nematodes$family,]
fun_table_nematodes_groups_family <- fun_table_nematodes_groups_family[fun_table_nematodes_groups_family$queryName %in% linked_tidytax_filter_nematodes$family,]
fun_table_nematodes_diets_family <- fun_table_nematodes_diets_family[fun_table_nematodes_diets_family$queryName %in% linked_tidytax_filter_nematodes$family,]
fun_table_nematodes_interactions_family <- fun_table_nematodes_interactions_family[fun_table_nematodes_interactions_family$queryName %in% linked_tidytax_filter_nematodes$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_nematodes_guilds_family$queryName, linked_tidytax_nematodes$family))

fun_table_numberoftaxa_nematodes_guilds_family <- as.data.frame(n_distinct(fun_table_nematodes_guilds_family$queryName))
fun_table_numberoftaxa_nematodes_guilds_family <- fun_table_numberoftaxa_nematodes_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_nematodes_guilds_family <- fun_table_numberoftaxa_nematodes_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_nematodes_guilds_family <- as.data.frame(n_distinct(fun_table_nematodes_guilds_family$guildName))
fun_table_numberofguilds_nematodes_guilds_family <- fun_table_numberofguilds_nematodes_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_nematodes_guilds_family <- fun_table_numberofguilds_nematodes_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_nematodes_diets_family$queryName, linked_tidytax_nematodes$family))

fun_table_numberoftaxa_nematodes_diets_family <- as.data.frame(n_distinct(fun_table_nematodes_diets_family$queryName))
fun_table_numberoftaxa_nematodes_diets_family <- fun_table_numberoftaxa_nematodes_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_nematodes_diets_family <- fun_table_numberoftaxa_nematodes_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_nematodes_diets_family <- as.data.frame(n_distinct(fun_table_nematodes_diets_family$dietName))
fun_table_numberofdiets_nematodes_diets_family <- fun_table_numberofdiets_nematodes_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_nematodes_diets_family <- fun_table_numberofdiets_nematodes_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_nematodes_groups_family$queryName, linked_tidytax_nematodes$family))

fun_table_numberoftaxa_nematodes_groups_family <- as.data.frame(n_distinct(fun_table_nematodes_groups_family$queryName))
fun_table_numberoftaxa_nematodes_groups_family <- fun_table_numberoftaxa_nematodes_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_nematodes_groups_family <- fun_table_numberoftaxa_nematodes_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_nematodes_groups_family <- as.data.frame(n_distinct(fun_table_nematodes_groups_family$trophicGroupName))
fun_table_numberofgroups_nematodes_groups_family <- fun_table_numberofgroups_nematodes_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_nematodes_groups_family <- fun_table_numberofgroups_nematodes_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_nematodes_interactions_family$queryName, linked_tidytax_nematodes$family))

fun_table_numberoftaxa_nematodes_interactions_family <- as.data.frame(n_distinct(fun_table_nematodes_interactions_family$queryName))
fun_table_numberoftaxa_nematodes_interactions_family <- fun_table_numberoftaxa_nematodes_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_nematodes_interactions_family <- fun_table_numberoftaxa_nematodes_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_nematodes_interactions_family <- as.data.frame(n_distinct(fun_table_nematodes_interactions_family$interactionName))
fun_table_numberofinteractionsname_nematodes_interactions_family <- fun_table_numberofinteractionsname_nematodes_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_nematodes_interactions_family <- fun_table_numberofinteractionsname_nematodes_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_nematodes_interactions_family <- as.data.frame(n_distinct(fun_table_nematodes_interactions_family$resourceName))
fun_table_numberofinteractionsresource_nematodes_interactions_family <- fun_table_numberofinteractionsresource_nematodes_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_nematodes_interactions_family <- fun_table_numberofinteractionsresource_nematodes_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_nematodes_family <- rbind(fun_table_numberoftaxa_nematodes_guilds_family, fun_table_numberofguilds_nematodes_guilds_family, fun_table_numberoftaxa_nematodes_diets_family, fun_table_numberofdiets_nematodes_diets_family, fun_table_numberoftaxa_nematodes_groups_family, fun_table_numberofgroups_nematodes_groups_family, fun_table_numberoftaxa_nematodes_interactions_family, fun_table_numberofinteractionsname_nematodes_interactions_family, fun_table_numberofinteractionsresource_nematodes_interactions_family)

fun_table_numberofall_nematodes_family <- fun_table_numberofall_nematodes_family %>% mutate("community" = "nematodes")
fun_table_numberofall_nematodes_family <- fun_table_numberofall_nematodes_family %>% mutate("level" = "family")
```

#### micro_arthropodes

```{r}
# Import fun_tables
fun_table_micro_arthropodes_guilds_family <- read.csv("final_files/fun_table/family/fun_micro_arthropodes_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_micro_arthropodes_groups_family <- read.csv("final_files/fun_table/family/fun_micro_arthropodes_groups_family.csv", sep=";")
fun_table_micro_arthropodes_diets_family <- read.csv("final_files/fun_table/family/fun_micro_arthropodes_diets_family.csv", sep=";")
fun_table_micro_arthropodes_interactions_family <- read.csv("final_files/fun_table/family/fun_micro_arthropodes_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_micro_arthropodes_guilds_family <- fun_table_micro_arthropodes_guilds_family[fun_table_micro_arthropodes_guilds_family$queryName %in% linked_tidytax_filter_micro_arthropodes$family,]
fun_table_micro_arthropodes_groups_family <- fun_table_micro_arthropodes_groups_family[fun_table_micro_arthropodes_groups_family$queryName %in% linked_tidytax_filter_micro_arthropodes$family,]
fun_table_micro_arthropodes_diets_family <- fun_table_micro_arthropodes_diets_family[fun_table_micro_arthropodes_diets_family$queryName %in% linked_tidytax_filter_micro_arthropodes$family,]
fun_table_micro_arthropodes_interactions_family <- fun_table_micro_arthropodes_interactions_family[fun_table_micro_arthropodes_interactions_family$queryName %in% linked_tidytax_filter_micro_arthropodes$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_micro_arthropodes_guilds_family$queryName, linked_tidytax_micro_arthropodes$family))

fun_table_numberoftaxa_micro_arthropodes_guilds_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_guilds_family$queryName))
fun_table_numberoftaxa_micro_arthropodes_guilds_family <- fun_table_numberoftaxa_micro_arthropodes_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_micro_arthropodes_guilds_family <- fun_table_numberoftaxa_micro_arthropodes_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_micro_arthropodes_guilds_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_guilds_family$guildName))
fun_table_numberofguilds_micro_arthropodes_guilds_family <- fun_table_numberofguilds_micro_arthropodes_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_micro_arthropodes_guilds_family <- fun_table_numberofguilds_micro_arthropodes_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_micro_arthropodes_diets_family$queryName, linked_tidytax_micro_arthropodes$family))

fun_table_numberoftaxa_micro_arthropodes_diets_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_diets_family$queryName))
fun_table_numberoftaxa_micro_arthropodes_diets_family <- fun_table_numberoftaxa_micro_arthropodes_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_micro_arthropodes_diets_family <- fun_table_numberoftaxa_micro_arthropodes_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_micro_arthropodes_diets_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_diets_family$dietName))
fun_table_numberofdiets_micro_arthropodes_diets_family <- fun_table_numberofdiets_micro_arthropodes_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_micro_arthropodes_diets_family <- fun_table_numberofdiets_micro_arthropodes_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_micro_arthropodes_groups_family$queryName, linked_tidytax_micro_arthropodes$family))

fun_table_numberoftaxa_micro_arthropodes_groups_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_groups_family$queryName))
fun_table_numberoftaxa_micro_arthropodes_groups_family <- fun_table_numberoftaxa_micro_arthropodes_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_micro_arthropodes_groups_family <- fun_table_numberoftaxa_micro_arthropodes_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_micro_arthropodes_groups_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_groups_family$trophicGroupName))
fun_table_numberofgroups_micro_arthropodes_groups_family <- fun_table_numberofgroups_micro_arthropodes_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_micro_arthropodes_groups_family <- fun_table_numberofgroups_micro_arthropodes_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_micro_arthropodes_interactions_family$queryName, linked_tidytax_micro_arthropodes$family))

fun_table_numberoftaxa_micro_arthropodes_interactions_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_interactions_family$queryName))
fun_table_numberoftaxa_micro_arthropodes_interactions_family <- fun_table_numberoftaxa_micro_arthropodes_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_micro_arthropodes_interactions_family <- fun_table_numberoftaxa_micro_arthropodes_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_micro_arthropodes_interactions_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_interactions_family$interactionName))
fun_table_numberofinteractionsname_micro_arthropodes_interactions_family <- fun_table_numberofinteractionsname_micro_arthropodes_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_micro_arthropodes_interactions_family <- fun_table_numberofinteractionsname_micro_arthropodes_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family <- as.data.frame(n_distinct(fun_table_micro_arthropodes_interactions_family$resourceName))
fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family <- fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family <- fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_micro_arthropodes_family <- rbind(fun_table_numberoftaxa_micro_arthropodes_guilds_family, fun_table_numberofguilds_micro_arthropodes_guilds_family, fun_table_numberoftaxa_micro_arthropodes_diets_family, fun_table_numberofdiets_micro_arthropodes_diets_family, fun_table_numberoftaxa_micro_arthropodes_groups_family, fun_table_numberofgroups_micro_arthropodes_groups_family, fun_table_numberoftaxa_micro_arthropodes_interactions_family, fun_table_numberofinteractionsname_micro_arthropodes_interactions_family, fun_table_numberofinteractionsresource_micro_arthropodes_interactions_family)

fun_table_numberofall_micro_arthropodes_family <- fun_table_numberofall_micro_arthropodes_family %>% mutate("community" = "micro_arthropodes")
fun_table_numberofall_micro_arthropodes_family <- fun_table_numberofall_micro_arthropodes_family %>% mutate("level" = "family")
```

#### bacteria

```{r}
# Import fun_tables
fun_table_bacteria_guilds_family <- read.csv("final_files/fun_table/family/fun_bacteria_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_bacteria_groups_family <- read.csv("final_files/fun_table/family/fun_bacteria_groups_family.csv", sep=";")
fun_table_bacteria_diets_family <- read.csv("final_files/fun_table/family/fun_bacteria_diets_family.csv", sep=";")
fun_table_bacteria_interactions_family <- read.csv("final_files/fun_table/family/fun_bacteria_interactions_family_mod.csv", sep=";")

# Filter based on conditions above
fun_table_bacteria_guilds_family <- fun_table_bacteria_guilds_family[fun_table_bacteria_guilds_family$queryName %in% linked_tidytax_filter_bacteria$family,]
fun_table_bacteria_groups_family <- fun_table_bacteria_groups_family[fun_table_bacteria_groups_family$queryName %in% linked_tidytax_filter_bacteria$family,]
fun_table_bacteria_diets_family <- fun_table_bacteria_diets_family[fun_table_bacteria_diets_family$queryName %in% linked_tidytax_filter_bacteria$family,]
fun_table_bacteria_interactions_family <- fun_table_bacteria_interactions_family[fun_table_bacteria_interactions_family$queryName %in% linked_tidytax_filter_bacteria$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_bacteria_guilds_family$queryName, linked_tidytax_bacteria$family))

fun_table_numberoftaxa_bacteria_guilds_family <- as.data.frame(n_distinct(fun_table_bacteria_guilds_family$queryName))
fun_table_numberoftaxa_bacteria_guilds_family <- fun_table_numberoftaxa_bacteria_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_bacteria_guilds_family <- fun_table_numberoftaxa_bacteria_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_bacteria_guilds_family <- as.data.frame(n_distinct(fun_table_bacteria_guilds_family$guildName))
fun_table_numberofguilds_bacteria_guilds_family <- fun_table_numberofguilds_bacteria_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_bacteria_guilds_family <- fun_table_numberofguilds_bacteria_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_bacteria_diets_family$queryName, linked_tidytax_bacteria$family))

fun_table_numberoftaxa_bacteria_diets_family <- as.data.frame(n_distinct(fun_table_bacteria_diets_family$queryName))
fun_table_numberoftaxa_bacteria_diets_family <- fun_table_numberoftaxa_bacteria_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_bacteria_diets_family <- fun_table_numberoftaxa_bacteria_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_bacteria_diets_family <- as.data.frame(n_distinct(fun_table_bacteria_diets_family$dietName))
fun_table_numberofdiets_bacteria_diets_family <- fun_table_numberofdiets_bacteria_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_bacteria_diets_family <- fun_table_numberofdiets_bacteria_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_bacteria_groups_family$queryName, linked_tidytax_bacteria$family))

fun_table_numberoftaxa_bacteria_groups_family <- as.data.frame(n_distinct(fun_table_bacteria_groups_family$queryName))
fun_table_numberoftaxa_bacteria_groups_family <- fun_table_numberoftaxa_bacteria_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_bacteria_groups_family <- fun_table_numberoftaxa_bacteria_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_bacteria_groups_family <- as.data.frame(n_distinct(fun_table_bacteria_groups_family$trophicGroupName))
fun_table_numberofgroups_bacteria_groups_family <- fun_table_numberofgroups_bacteria_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_bacteria_groups_family <- fun_table_numberofgroups_bacteria_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_bacteria_interactions_family$queryName, linked_tidytax_bacteria$family))

fun_table_numberoftaxa_bacteria_interactions_family <- as.data.frame(n_distinct(fun_table_bacteria_interactions_family$queryName))
fun_table_numberoftaxa_bacteria_interactions_family <- fun_table_numberoftaxa_bacteria_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_bacteria_interactions_family <- fun_table_numberoftaxa_bacteria_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_bacteria_interactions_family <- as.data.frame(n_distinct(fun_table_bacteria_interactions_family$interactionName))
fun_table_numberofinteractionsname_bacteria_interactions_family <- fun_table_numberofinteractionsname_bacteria_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_bacteria_interactions_family <- fun_table_numberofinteractionsname_bacteria_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_bacteria_interactions_family <- as.data.frame(n_distinct(fun_table_bacteria_interactions_family$resourceName))
fun_table_numberofinteractionsresource_bacteria_interactions_family <- fun_table_numberofinteractionsresource_bacteria_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_bacteria_interactions_family <- fun_table_numberofinteractionsresource_bacteria_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_bacteria_family <- rbind(fun_table_numberoftaxa_bacteria_guilds_family, fun_table_numberofguilds_bacteria_guilds_family, fun_table_numberoftaxa_bacteria_diets_family, fun_table_numberofdiets_bacteria_diets_family, fun_table_numberoftaxa_bacteria_groups_family, fun_table_numberofgroups_bacteria_groups_family, fun_table_numberoftaxa_bacteria_interactions_family, fun_table_numberofinteractionsname_bacteria_interactions_family, fun_table_numberofinteractionsresource_bacteria_interactions_family)

fun_table_numberofall_bacteria_family <- fun_table_numberofall_bacteria_family %>% mutate("community" = "bacteria")
fun_table_numberofall_bacteria_family <- fun_table_numberofall_bacteria_family %>% mutate("level" = "family")
```

#### fungi

```{r}
# Import fun_tables
fun_table_fungi_guilds_family <- read.csv("final_files/fun_table/family/fun_fungi_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_fungi_groups_family <- read.csv("final_files/fun_table/family/fun_fungi_groups_family.csv", sep=";")
fun_table_fungi_diets_family <- read.csv("final_files/fun_table/family/fun_fungi_diets_family.csv", sep=";")
fun_table_fungi_interactions_family <- read.csv("final_files/fun_table/family/fun_fungi_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_fungi_guilds_family <- fun_table_fungi_guilds_family[fun_table_fungi_guilds_family$queryName %in% linked_tidytax_filter_fungi$family,]
fun_table_fungi_groups_family <- fun_table_fungi_groups_family[fun_table_fungi_groups_family$queryName %in% linked_tidytax_filter_fungi$family,]
fun_table_fungi_diets_family <- fun_table_fungi_diets_family[fun_table_fungi_diets_family$queryName %in% linked_tidytax_filter_fungi$family,]
fun_table_fungi_interactions_family <- fun_table_fungi_interactions_family[fun_table_fungi_interactions_family$queryName %in% linked_tidytax_filter_fungi$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_fungi_guilds_family$queryName, linked_tidytax_fungi$family))

fun_table_numberoftaxa_fungi_guilds_family <- as.data.frame(n_distinct(fun_table_fungi_guilds_family$queryName))
fun_table_numberoftaxa_fungi_guilds_family <- fun_table_numberoftaxa_fungi_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_fungi_guilds_family <- fun_table_numberoftaxa_fungi_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_fungi_guilds_family <- as.data.frame(n_distinct(fun_table_fungi_guilds_family$guildName))
fun_table_numberofguilds_fungi_guilds_family <- fun_table_numberofguilds_fungi_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_fungi_guilds_family <- fun_table_numberofguilds_fungi_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_fungi_diets_family$queryName, linked_tidytax_fungi$family))

fun_table_numberoftaxa_fungi_diets_family <- as.data.frame(n_distinct(fun_table_fungi_diets_family$queryName))
fun_table_numberoftaxa_fungi_diets_family <- fun_table_numberoftaxa_fungi_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_fungi_diets_family <- fun_table_numberoftaxa_fungi_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_fungi_diets_family <- as.data.frame(n_distinct(fun_table_fungi_diets_family$dietName))
fun_table_numberofdiets_fungi_diets_family <- fun_table_numberofdiets_fungi_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_fungi_diets_family <- fun_table_numberofdiets_fungi_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_fungi_groups_family$queryName, linked_tidytax_fungi$family))

fun_table_numberoftaxa_fungi_groups_family <- as.data.frame(n_distinct(fun_table_fungi_groups_family$queryName))
fun_table_numberoftaxa_fungi_groups_family <- fun_table_numberoftaxa_fungi_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_fungi_groups_family <- fun_table_numberoftaxa_fungi_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_fungi_groups_family <- as.data.frame(n_distinct(fun_table_fungi_groups_family$trophicGroupName))
fun_table_numberofgroups_fungi_groups_family <- fun_table_numberofgroups_fungi_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_fungi_groups_family <- fun_table_numberofgroups_fungi_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_fungi_interactions_family$queryName, linked_tidytax_fungi$family))

fun_table_numberoftaxa_fungi_interactions_family <- as.data.frame(n_distinct(fun_table_fungi_interactions_family$queryName))
fun_table_numberoftaxa_fungi_interactions_family <- fun_table_numberoftaxa_fungi_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_fungi_interactions_family <- fun_table_numberoftaxa_fungi_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_fungi_interactions_family <- as.data.frame(n_distinct(fun_table_fungi_interactions_family$interactionName))
fun_table_numberofinteractionsname_fungi_interactions_family <- fun_table_numberofinteractionsname_fungi_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_fungi_interactions_family <- fun_table_numberofinteractionsname_fungi_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_fungi_interactions_family <- as.data.frame(n_distinct(fun_table_fungi_interactions_family$resourceName))
fun_table_numberofinteractionsresource_fungi_interactions_family <- fun_table_numberofinteractionsresource_fungi_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_fungi_interactions_family <- fun_table_numberofinteractionsresource_fungi_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_fungi_family <- rbind(fun_table_numberoftaxa_fungi_guilds_family, fun_table_numberofguilds_fungi_guilds_family, fun_table_numberoftaxa_fungi_diets_family, fun_table_numberofdiets_fungi_diets_family, fun_table_numberoftaxa_fungi_groups_family, fun_table_numberofgroups_fungi_groups_family, fun_table_numberoftaxa_fungi_interactions_family, fun_table_numberofinteractionsname_fungi_interactions_family, fun_table_numberofinteractionsresource_fungi_interactions_family)

fun_table_numberofall_fungi_family <- fun_table_numberofall_fungi_family %>% mutate("community" = "fungi")
fun_table_numberofall_fungi_family <- fun_table_numberofall_fungi_family %>% mutate("level" = "family")
```

#### protists

```{r}
# Import fun_tables
fun_table_protists_guilds_family <- read.csv("final_files/fun_table/family/fun_protists_guilds_family.csv", sep=";") # sep="," for genus, sep=";" for family
fun_table_protists_groups_family <- read.csv("final_files/fun_table/family/fun_protists_groups_family.csv", sep=";")
fun_table_protists_diets_family <- read.csv("final_files/fun_table/family/fun_protists_diets_family.csv", sep=";")
fun_table_protists_interactions_family <- read.csv("final_files/fun_table/family/fun_protists_interactions_family.csv", sep=";")

# Filter based on conditions above
fun_table_protists_guilds_family <- fun_table_protists_guilds_family[fun_table_protists_guilds_family$queryName %in% linked_tidytax_filter_protists$family,]
fun_table_protists_groups_family <- fun_table_protists_groups_family[fun_table_protists_groups_family$queryName %in% linked_tidytax_filter_protists$family,]
fun_table_protists_diets_family <- fun_table_protists_diets_family[fun_table_protists_diets_family$queryName %in% linked_tidytax_filter_protists$family,]
fun_table_protists_interactions_family <- fun_table_protists_interactions_family[fun_table_protists_interactions_family$queryName %in% linked_tidytax_filter_protists$family,]

# Count the number of distinct taxa and guilds/diets/groups/interactions
## guilds
length(setdiff(fun_table_protists_guilds_family$queryName, linked_tidytax_protists$family))

fun_table_numberoftaxa_protists_guilds_family <- as.data.frame(n_distinct(fun_table_protists_guilds_family$queryName))
fun_table_numberoftaxa_protists_guilds_family <- fun_table_numberoftaxa_protists_guilds_family %>% rename("number" = 1)
fun_table_numberoftaxa_protists_guilds_family <- fun_table_numberoftaxa_protists_guilds_family %>% mutate("variable" = "queryName from get.guilds output")

fun_table_numberofguilds_protists_guilds_family <- as.data.frame(n_distinct(fun_table_protists_guilds_family$guildName))
fun_table_numberofguilds_protists_guilds_family <- fun_table_numberofguilds_protists_guilds_family %>% rename("number" = 1)
fun_table_numberofguilds_protists_guilds_family <- fun_table_numberofguilds_protists_guilds_family %>% mutate("variable" = "guildName")

## diets
length(setdiff(fun_table_protists_diets_family$queryName, linked_tidytax_protists$family))

fun_table_numberoftaxa_protists_diets_family <- as.data.frame(n_distinct(fun_table_protists_diets_family$queryName))
fun_table_numberoftaxa_protists_diets_family <- fun_table_numberoftaxa_protists_diets_family %>% rename("number" = 1)
fun_table_numberoftaxa_protists_diets_family <- fun_table_numberoftaxa_protists_diets_family %>% mutate("variable" = "queryName from get.diets output")

fun_table_numberofdiets_protists_diets_family <- as.data.frame(n_distinct(fun_table_protists_diets_family$dietName))
fun_table_numberofdiets_protists_diets_family <- fun_table_numberofdiets_protists_diets_family %>% rename("number" = 1)
fun_table_numberofdiets_protists_diets_family <- fun_table_numberofdiets_protists_diets_family %>% mutate("variable" = "dietName")

## groups
length(setdiff(fun_table_protists_groups_family$queryName, linked_tidytax_protists$family))

fun_table_numberoftaxa_protists_groups_family <- as.data.frame(n_distinct(fun_table_protists_groups_family$queryName))
fun_table_numberoftaxa_protists_groups_family <- fun_table_numberoftaxa_protists_groups_family %>% rename("number" = 1)
fun_table_numberoftaxa_protists_groups_family <- fun_table_numberoftaxa_protists_groups_family %>% mutate("variable" = "queryName from get.trophic.groups output")

fun_table_numberofgroups_protists_groups_family <- as.data.frame(n_distinct(fun_table_protists_groups_family$trophicGroupName))
fun_table_numberofgroups_protists_groups_family <- fun_table_numberofgroups_protists_groups_family %>% rename("number" = 1)
fun_table_numberofgroups_protists_groups_family <- fun_table_numberofgroups_protists_groups_family %>% mutate("variable" = "trophicGroupName")

## interactions
length(setdiff(fun_table_protists_interactions_family$queryName, linked_tidytax_protists$family))

fun_table_numberoftaxa_protists_interactions_family <- as.data.frame(n_distinct(fun_table_protists_interactions_family$queryName))
fun_table_numberoftaxa_protists_interactions_family <- fun_table_numberoftaxa_protists_interactions_family %>% rename("number" = 1)
fun_table_numberoftaxa_protists_interactions_family <- fun_table_numberoftaxa_protists_interactions_family %>% mutate("variable" = "queryName from get.interactions output")

fun_table_numberofinteractionsname_protists_interactions_family <- as.data.frame(n_distinct(fun_table_protists_interactions_family$interactionName))
fun_table_numberofinteractionsname_protists_interactions_family <- fun_table_numberofinteractionsname_protists_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsname_protists_interactions_family <- fun_table_numberofinteractionsname_protists_interactions_family %>% mutate("variable" = "interactionName")

fun_table_numberofinteractionsresource_protists_interactions_family <- as.data.frame(n_distinct(fun_table_protists_interactions_family$resourceName))
fun_table_numberofinteractionsresource_protists_interactions_family <- fun_table_numberofinteractionsresource_protists_interactions_family %>% rename("number" = 1)
fun_table_numberofinteractionsresource_protists_interactions_family <- fun_table_numberofinteractionsresource_protists_interactions_family %>% mutate("variable" = "resourceName")

# Bind the objects
fun_table_numberofall_protists_family <- rbind(fun_table_numberoftaxa_protists_guilds_family, fun_table_numberofguilds_protists_guilds_family, fun_table_numberoftaxa_protists_diets_family, fun_table_numberofdiets_protists_diets_family, fun_table_numberoftaxa_protists_groups_family, fun_table_numberofgroups_protists_groups_family, fun_table_numberoftaxa_protists_interactions_family, fun_table_numberofinteractionsname_protists_interactions_family, fun_table_numberofinteractionsresource_protists_interactions_family)

fun_table_numberofall_protists_family <- fun_table_numberofall_protists_family %>% mutate("community" = "protists")
fun_table_numberofall_protists_family <- fun_table_numberofall_protists_family %>% mutate("level" = "family")
```

## Export results

```{r}
fun_table_numberofall_ALL_family <- bind_rows(fun_table_numberofall_macrofauna_surface_family, fun_table_numberofall_macrofauna_aerial_family, fun_table_numberofall_macrofauna_foliar_family, fun_table_numberofall_nematodes_family, fun_table_numberofall_micro_arthropodes_family, fun_table_numberofall_bacteria_family, fun_table_numberofall_fungi_family, fun_table_numberofall_protists_family) # bind all communities in one file

write.csv(fun_table_numberofall_ALL_family, "intermediate_files/datachecking/results_fun_family_update29-05-24.csv")
```

Do section 2 by replacing family -> genus

# 3. Proportion graphs and tables
(to have number of taxa by level, community, method, date... and their relative abundances)

```{r}
tidytax_ALL_long <- pivot_longer(tidytax_ALL, cols = c(10:16), names_to = "level", values_to = "taxa")

order_level =c("kingdom","phylum","class","order","family","genus","species")
tidytax_ALL_long$level <- ordered(tidytax_ALL_long$level, order_level)
order_community =c("macrofauna_surface","macrofauna_aerial","macrofauna_foliar","micro_arthropodes","nematodes","bacteria","fungi","protists")
tidytax_ALL_long$community <- ordered(tidytax_ALL_long$community, order_community)

tidytax_ALL_long <- tidytax_ALL_long[which(tidytax_ALL_long$taxa != 'unassigned'),]

A <- ggplot(tidytax_ALL_long, aes(level, abundance)) + geom_col(position = "dodge") + facet_grid(community ~ ., scales="free")

ggsave("results/tidytax_assignation_levelXcommunity.png")
```


